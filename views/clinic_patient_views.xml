<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Patient list View -->
        <record id="view_clinic_patient_list" model="ir.ui.view">
            <field name="name">clinic.patient.list</field>
            <field name="model">clinic.patient</field>
            <field name="arch" type="xml">
                <list string="Patients" sample="1">
                    <field name="patient_id"/>
                    <field name="name"/>
                    <field name="age"/>
                    <field name="gender"/>
                    <field name="phone"/>
                    <field name="last_visit_date"/>
                    <field name="vital_signs_count"/>
                    <field name="prescription_count"/>
                    <field name="active" invisible="1"/>
                </list>
            </field>
        </record>
        <!-- Patient Form View -->
        <record id="view_clinic_patient_form" model="ir.ui.view">
            <field name="name">clinic.patient.form</field>
            <field name="model">clinic.patient</field>
            <field name="arch" type="xml">
                <form string="Patient">
                    <header>
                        <button name="action_create_vital_signs" type="object"
                                string="Record Vital Signs" class="btn-primary"
                                />
                        <button name="action_create_prescription" type="object"
                                string="Create Prescription" class="btn-primary"
                               />
                        <button name="archive_patient" type="object"
                                string="Archive Patient" class="btn-secondary"
                                invisible="active == False"/>
                        <button name="unarchive_patient" type="object"
                                string="Unarchive Patient" class="btn-secondary"
                                invisible= "active == True"/>
                        <field name="active" widget="boolean_toggle" options="{'terminology': 'archive'}"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_vital_signs" type="object"
                                    class="oe_stat_button" icon="fa-heartbeat">
                                <field name="vital_signs_count" widget="statinfo"
                                       string="Vital Signs"/>
                            </button>
                            <button name="action_view_prescriptions" type="object"
                                    class="oe_stat_button" icon="fa-prescription">
                                <field name="prescription_count" widget="statinfo"
                                       string="Prescriptions"/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Patient Full Name" required="1"/>
                            </h1>
                            <h2>
                                <field name="patient_id" readonly="1"/>
                            </h2>
                        </div>
                        <group>
                            <group name="personal_info" string="Personal Information">
                                <field name="date_of_birth"/>
                                <field name="age" readonly="1"/>
                                <field name="gender"/>
                                <field name="marital_status"/>
                                <field name="occupation"/>
                            </group>
                            <group name="contact_info" string="Contact Information">
                                <field name="phone"/>
                                <field name="city"/>
                            </group>
                            <!-- Conditional: Gestational History for non-single females -->
                            <group string="Gestational History"
                                   invisible="gender != 'female' or marital_status == 'single'">
                            <div class="o_row">
                                <label for="gravida" string="G:"/>
                                <field name="gravida" class="o_input_small" style="width:60px;"/>
                                <label for="para" string="P:" style="margin-left:10px;"/>
                                <field name="para" class="o_input_small" style="width:60px;"/>
                                <label for="abortion" string="A:" style="margin-left:10px;"/>
                                <field name="abortion" class="o_input_small" style="width:60px;"/>
                            </div>
                        </group>
                            <group string="Children Information"
                                   invisible="gender != 'male' or marital_status == 'single'">
                                <field name="number_of_children"/>
                            </group>
                            <!-- Conditional: Contraception history (females only) -->
                            <group string="Contraception"
                                   invisible="gender != 'female'">
                                <field name="contraception_history"/>
                            </group>
                            <!-- Conditional: Puberty age (males only) -->
                            <group string="Puberty"
                                   invisible="gender != 'male'">
                                <field name="puberty_age"/>
                            </group>
                            <!-- Conditional: Menarche age (females only) -->
                            <group string="Menarche"
                                   invisible="gender != 'female'">
                                <field name="menarche_age"/>
                            </group>
                        </group>
                        <notebook>
                             <page name="main_complaint" string="Main Complaint">
                                <field name="main_complaint_ids"
                                       context="{'default_patient_id': id}" options="{'autosave': True}">
                                    <list string="Main Complaints Records">
                                        <field name="date"/>
                                        <field name="description"
                                              placeholder="why the patient came to visit ?" />
                                    </list>
                                </field>
                            </page>
                            <page name="medical_history" string="Medical History">
                                <group>
                                    <field name="history_present_illness" placeholder="Current illness history and symptoms..."/>
                                    <field name="past_history" placeholder="Previous operations , accidences ,blood transfusion , disses,etc. "/>
                                    <field name="family_history" placeholder="Relevant family medical history..."/>
                                    <field name="allergies" placeholder="List all known allergies with severity and reactions..."/>
                                    <field name="social_history" placeholder="Smoking, alcohol, drug use, and lifestyle factors..."/>
                                </group>
                            </page>
                            <page name="vital_signs" string="Examination">
                                <field name="vital_signs_ids" context="{'default_patient_id': id}">
                                    <list string="Examination Records" limit="10" >
                                        <field name="visit_datetime"/>
                                        <field name="main_complaint_id"/>
                                        <field name="visit_type"/>
                                        <field name="blood_pressure_display"/>
                                        <field name="heart_rate"/>
                                        <field name="temperature"/>
                                        <field name="weight"/>
                                        <field name="bmi"/>
                                        <field name="recorded_by"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Lab Results">
                                <field name="lab_result_ids">
                                    <list>
                                        <field name="date"/>
                                        <field name="test_name"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Prescriptions">
                                <field name="prescription_ids" context="{'default_patient_id': id}">
                                    <list>
                                        <field name="name" string="Prescription"/>  <!-- Displays the custom name -->
                                        <field name="create_date" string="Date"/>  <!-- Optional, hide by default -->
                                        <button name="open_auto_print" type="object" string=    "Print" class="btn-primary" icon="fa-print"/>
                                    </list>
                                    <form>
                                        <sheet>
                                            <group>
                                                <field name="patient_id" readonly="1"/>
                                            </group>
                                            <notebook>
                                                <page string="Treatments">
                                                    <field name="treatment_line_ids">
                                                        <list editable="bottom">
                                                            <field name="treatment_id" options="{'no_quick_create': True}"/>
                                                            <field name="usage_ar"/>
                                                        </list>
                                                        <form>
                                                            <sheet>
                                                                <group>
                                                                    <field name="treatment_id" options="{'no_quick_create': True}"/>
                                                                    <field name="usage_ar"/>
                                                                </group>
                                                            </sheet>
                                                        </form>
                                                    </field>
                                                </page>
                                            </notebook>
                                        </sheet>
                                    </form>
                                </field>
                            </page>
                            <page name="notes" string="Notes">
                                <field name="notes" placeholder="Additional notes and observations..."/>
                            </page>
                        </notebook>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>
        <!-- Patient Kanban View -->
        <record id="view_clinic_patient_kanban" model="ir.ui.view">
            <field name="name">clinic.patient.kanban</field>
            <field name="model">clinic.patient</field>
            <field name="arch" type="xml">
                <kanban string="Patients" sample="1">
                    <field name="id"/>
                    <field name="name"/>
                    <field name="patient_id"/>
                    <field name="age"/>
                    <field name="gender"/>
                    <field name="phone"/>
                    <field name="last_visit_date"/>
                    <field name="vital_signs_count"/>
                    <field name="prescription_count"/>
                    <field name="active"/>
                    <templates>
                        <t t-name="card">  <!-- Changed from "kanban-box" to "card" -->
                            <div class="oe_kanban_card oe_kanban_global_click">
                                <div class="oe_kanban_details">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="name"/>
                                            </strong>
                                            <br/>
                                            <span class="o_kanban_record_subtitle">
                                                <field name="patient_id"/> • <field name="age"/> years • <field name="gender"/>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <field name="phone" widget="phone"/>
                                        <br/>
                                    </div>
                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left">
                                            <span class="badge badge-pill badge-info">
                                                <i class="fa fa-heartbeat"/> <field name="vital_signs_count"/>
                                            </span>
                                            <span class="badge badge-pill badge-warning">
                                                <i class="fa fa-prescription"/> <field name="prescription_count"/>
                                            </span>
                                        </div>
                                        <div class="oe_kanban_bottom_right">
                                            <field name="last_visit_date" widget="date"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
    </data>
</odoo>
