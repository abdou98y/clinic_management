<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Patient list View -->
        <record id="view_clinic_patient_list" model="ir.ui.view">
            <field name="name">clinic.patient.list</field>
            <field name="model">clinic.patient</field>
            <field name="arch" type="xml">
                <list string="Patients" sample="1">
                    <field name="patient_id"/>
                    <field name="name"/>
                    <field name="age"/>
                    <field name="gender"/>
                    <field name="phone"/>
                    <field name="email"/>
                    <field name="last_visit_date"/>
                    <field name="vital_signs_count"/>
                    <field name="prescription_count"/>
                    <field name="active" invisible="1"/>
                </list>
            </field>
        </record>

        <!-- Patient Form View -->
        <record id="view_clinic_patient_form" model="ir.ui.view">
            <field name="name">clinic.patient.form</field>
            <field name="model">clinic.patient</field>
            <field name="arch" type="xml">
                <form string="Patient">
                    <header>
                        <button name="action_create_vital_signs" type="object" 
                                string="Record Vital Signs" class="btn-primary"
                                groups="clinic_management.group_clinic_medical_assistant"/>
                        <button name="action_create_prescription" type="object" 
                                string="Create Prescription" class="btn-primary"
                                groups="clinic_management.group_clinic_physician"/>
                        <button name="archive_patient" type="object" 
                                string="Archive Patient" class="btn-secondary"
                                groups="clinic_management.group_clinic_practice_manager"
                                invisible="active == False"/>
                                
                        <button name="unarchive_patient" type="object" 
                                string="Unarchive Patient" class="btn-secondary"
                                groups="clinic_management.group_clinic_practice_manager"
                                invisible= "active == True"/>
                        <field name="active" widget="boolean_toggle" options="{'terminology': 'archive'}"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_vital_signs" type="object" 
                                    class="oe_stat_button" icon="fa-heartbeat">
                                <field name="vital_signs_count" widget="statinfo" 
                                       string="Vital Signs"/>
                            </button>
                            <button name="action_view_prescriptions" type="object" 
                                    class="oe_stat_button" icon="fa-prescription">
                                <field name="prescription_count" widget="statinfo" 
                                       string="Prescriptions"/>
                            </button>
                        </div>
                        
                        <field name="image" widget="image" class="oe_avatar"/>
                        
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Patient Full Name" required="1"/>
                            </h1>
                            <h2>
                                <field name="patient_id" readonly="1"/>
                            </h2>
                        </div>

                        <group>
                            <group name="personal_info" string="Personal Information">
                                <field name="date_of_birth"/>
                                <field name="age" readonly="1"/>
                                <field name="gender" required="1"/>
                                <field name="marital_status"/>
                                <field name="occupation"/>
                                <field name="blood_group"/>
                            </group>
                            <group name="contact_info" string="Contact Information">
                                <field name="phone"/>
                                <field name="mobile"/>
                                <field name="email"/>
                                <!-- <field name="slistt"/> -->
                                <!-- <field name="slistt2"/> -->
                                <field name="city"/>
                                <field name="state_id"/>
                                <field name="zip"/>
                                <field name="country_id"/>
                            </group>
                        </group>

                        <group name="emergency_contact" string="Emergency Contact">
                            <group>
                                <field name="emergency_contact_name"/>
                                <field name="emergency_contact_phone"/>
                                <field name="emergency_contact_relationship"/>
                            </group>
                        </group>

                        <notebook>
                            <page name="medical_history" string="Medical History">
                                <group>
                                    <field name="allergies" placeholder="List all known allergies with severity and reactions..."/>
                                    <field name="chronic_conditions" placeholder="List ongoing medical conditions requiring management..."/>
                                    <field name="past_treatments" placeholder="Previous treatments, surgeries, and hospitalizations..."/>
                                    <field name="current_medications" placeholder="Current medications from other providers..."/>
                                    <field name="family_history" placeholder="Relevant family medical history..."/>
                                    <field name="social_history" placeholder="Smoking, alcohol, drug use, and lifestyle factors..."/>
                                </group>
                            </page>
                            
                            <page name="vital_signs" string="Vital Signs History">
                                <field name="vital_signs_ids" readonly="1">
                                    <list string="Vital Signs Records" limit="10">
                                        <field name="visit_datetime"/>
                                        <field name="visit_type"/>
                                        <field name="blood_pressure_display"/>
                                        <field name="heart_rate"/>
                                        <field name="temperature"/>
                                        <field name="weight"/>
                                        <field name="bmi"/>
                                        <field name="recorded_by"/>
                                    </list>
                                </field>
                            </page>
                            
                            <page name="prescriptions" string="Prescription History">
                                <field name="prescription_ids" readonly="1">
                                    <list string="Prescriptions" limit="10">
                                        <field name="prescription_number"/>
                                        <field name="prescription_date"/>
                                        <field name="prescriber_id"/>
                                        <field name="total_medications"/>
                                        <field name="state"/>
                                        <field name="controlled_substances"/>
                                    </list>
                                </field>
                            </page>

                            <page string="Lab Results">
                                <field name="lab_result_ids">  <!-- Add this field in models/res_partner.py if needed -->
                                    <list>
                                        <field name="date"/>
                                        <field name="test_name"/>
                                    </list>
                                </field>
                            </page>
                            
                            <page name="notes" string="Notes">
                                <field name="notes" placeholder="Additional notes and observations..."/>
                            </page>
                        </notebook>
                    </sheet>
                    <chatter/>
                    <!-- <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div> -->
                </form>
            </field>
        </record>

        <!-- Patient Search View -->
        <!-- <record id="view_clinic_patient_search" model="ir.ui.view">
            <field name="name">clinic.patient.search</field>
            <field name="model">clinic.patient</field>
            <field name="arch" type="xml">
                <search string="Search Patients">
                    <field name="name" string="Patient Name" />
                    
                    
                    <field name="patient_id"/>
                    <field name="phone"/>
                    <field name="email"/>
                    <field name="allergies"/>
                    <field name="chronic_conditions"/>
                    
                    <filter name="active_patients" string="Active Patients" 
                            domain="[('active', '=', True)]" default="1"/>
                    <filter name="archived_patients" string="Archived Patients" 
                            domain="[('active', '=', False)]"/>
                    
                    <separator/>
                    <filter name="male" string="Male" domain="[('gender', '=', 'male')]"/>
                    <filter name="female" string="Female" domain="[('gender', '=', 'female')]"/>
                    
                    <separator/>
                    <filter name="has_allergies" string="Has Allergies" 
                            domain="[('allergies', '!=', False)]"/>
                    <filter name="has_chronic_conditions" string="Has Chronic Conditions" 
                            domain="[('chronic_conditions', '!=', False)]"/>
                    
                    <separator/> -->
                    <!-- <filter name="recent_visits" string="Recent Visits (30 days)" 
                            domain="[('last_visit_date', '>=', (context_today() - datetime.timedelta(days=30)).strftime('%Y-%m-%d'))]"/>
                    <filter name="needs_followup" string="Needs Follow-up" 
                            domain="[('last_visit_date', '&lt;', (context_today() - datetime.timedelta(days=90)).strftime('%Y-%m-%d')), ('chronic_conditions', '!=', False)]"/> -->
                    
                    <!-- <group expand="0" string="Group By">
                        <filter name="group_by_gender" string="Gender" 
                                context="{'group_by': 'gender'}"/>
                        <filter name="group_by_age_group" string="Age Group" 
                                context="{'group_by': 'age'}"/>
                        <filter name="group_by_blood_group" string="Blood Group" 
                                context="{'group_by': 'blood_group'}"/>
                    </group>
                </search>
            </field>
        </record> -->

        <!-- Patient Kanban View -->
        <record id="view_clinic_patient_kanban" model="ir.ui.view">
            <field name="name">clinic.patient.kanban</field>
            <field name="model">clinic.patient</field>
            <field name="arch" type="xml">
                <kanban string="Patients" sample="1">
                    <field name="id"/>
                    <field name="name"/>
                    <field name="patient_id"/>
                    <field name="age"/>
                    <field name="gender"/>
                    <field name="phone"/>
                    <field name="email"/>
                    <field name="last_visit_date"/>
                    <field name="vital_signs_count"/>
                    <field name="prescription_count"/>
                    <field name="image"/>
                    <field name="active"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_card oe_kanban_global_click">
                                <div class="o_kanban_image">
                                    <img t-att-src="kanban_image('clinic.patient', 'image', record.id.raw_value)" 
                                         alt="Patient" class="o_image_64_cover"/>
                                </div>
                                <div class="oe_kanban_details">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="name"/>
                                            </strong>
                                            <br/>
                                            <span class="o_kanban_record_subtitle">
                                                <field name="patient_id"/> • <field name="age"/> years • <field name="gender"/>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <field name="phone" widget="phone"/>
                                        <br/>
                                        <field name="email" widget="email"/>
                                    </div>
                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left">
                                            <span class="badge badge-pill badge-info">
                                                <i class="fa fa-heartbeat"/> <field name="vital_signs_count"/>
                                            </span>
                                            <span class="badge badge-pill badge-warning">
                                                <i class="fa fa-prescription"/> <field name="prescription_count"/>
                                            </span>
                                        </div>
                                        <div class="oe_kanban_bottom_right">
                                            <field name="last_visit_date" widget="date"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Patient Action -->
        <record id="action_clinic_patient" model="ir.actions.act_window">
            <field name="name">Patients</field>
            <field name="res_model">clinic.patient</field>
            <field name="view_mode">kanban,list,form</field>
            <!-- <field name="search_view_id" ref="view_clinic_patient_search"/> -->
            <field name="context">{'search_default_active_patients': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create your first patient record
                </p>
                <p>
                    Start by registering patients with their personal information,
                    contact details, and medical history. You can then record vital signs
                    and create prescriptions for comprehensive patient care.
                </p>
            </field>
        </record>

    </data>
</odoo>

