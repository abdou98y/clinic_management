<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="template_medical_prescription">
        <!-- We use ONLY html_container + running elements — this is the ONLY method that gives 100% clean result on Windows -->
        <t t-call="web.html_container">
            <t t-set="doc" t-value="doc.with_context(lang='ar_SY')"/>

            <!-- Force UTF-8 + Tajawal + A5 -->
            <meta charset="UTF-8"/>
            <style>
                @page {
                     size: A5;
                     margin: 0;
                     padding: 0;
                     @top-center { content: element(header); }
                     @bottom-center { content: element(footer); }
                 }
                 .header { position: running(header); padding: 18mm 12mm 10mm 12mm; }
                 .footer { position: running(footer); padding: 10mm 12mm 18mm 12mm; }
                 body { font-family: 'Tajawal', sans-serif; direction: rtl; font-size: 13pt; }
                 .content { padding: 0 12mm; }
            </style>

            <!-- YOUR HEADER — EXACTLY AS YOU WANT — REPEATS ON EVERY PAGE -->
            <div class="header" style="margin-top:0px; padding-top:0px;">
                <div style="border-bottom:2pt solid #000; padding-bottom:6pt;">
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td width="48%" align="right" valign="top" >
                                <div style="border:2pt solid #000;background:#f9f9f9;padding:12pt;border-radius:8pt;font-size:12pt;">
                                    <div><strong>التاريخ:</strong> <t t-esc="doc.create_date.strftime('%d/%m/%Y')"/></div>
                                    <div style="margin:8pt 0;font-size:15pt;"><strong>الاسم:</strong> <t t-esc="doc.patient_id.name or 'غير محدد'"/></div>
                                    <div><strong>العمر:</strong> <t t-esc="doc.patient_id.age or ''"/> سنة</div>
                                </div>
                            </td>
                            <td width="52%" align="right" >
                                <img src="/clinic_management/static/src/img/doctor_header.png"
                                     style="margin-top:44pt; max-height:130px; width:100%; object-fit:contain; "
                                     alt="Clinic Header"/>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- MAIN CONTENT -->
            <div class="content">
                <div style="font-size:68pt;font-weight:bold;font-family:'Times New Roman';text-align:left;margin:20pt 0;">
                    /R
                </div>

                <t t-if="not doc.treatment_line_ids">
                    <div style="text-align:center;font-size:16pt;padding:160pt 0;color:#999;">
                        لا توجد أدوية موصوفة
                    </div>
                </t>

                <t t-foreach="doc.treatment_line_ids" t-as="line">
                    <div style="margin:35pt 0;border-bottom:1pt dashed #666;padding-bottom:15pt;">
                        <div style="font-weight:bold;font-size:16pt;text-align:left;">
                            <t t-esc="line.treatment_id.name or line.treatment_name or 'اسم الدواء'"/>
                        </div>
                        <div style="margin-top:12pt;font-size:14pt;line-height:1.9;">
                            <t t-esc="line.usage_ar or 'طريقة الاستعمال'"/>
                        </div>
                    </div>
                </t>
            </div>

            <!-- YOUR FOOTER — EXACTLY AS YOU WANT — REPEATS ON EVERY PAGE -->
            <div class="footer">
                <div style="border-top:2pt solid #000;padding-top:14pt;font-size:11.5pt;">
                    <table width="100%">
                        <tr>
                            <td width="40%" align="left" style="direction:ltr;font-family:monospace;">
                                <br/>01012000168<br/>01021208060
                            </td>
                            <td width="60%" align="right">
                                <div style="font-weight:bold;">نعتذر عن استقبال حالات الطوارئ – الكشف والاستشارة بحجز مسبق فقط</div>
                                <div style="margin-top:6pt;">
                                    عيادة مركز بدر أمام بدر سكان<br/>
                                    عيادة مدينة السادات - خلف مستشفى السادات التخصصي
                                </div>
                            </td>
                        </tr>
                    </table>
                    <!-- ONLY ONE PAGE NUMBER -->
                    <div style="text-align:center;margin-top:12pt;color:#777;">
                        صفحة <span class="page"/> من <span class="topage"/>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
